<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juliu's Special 5 - Orden Automático</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 10px; color: #2c3e50; }
        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: #2c3e50; color: white; padding: 20px; text-align: center; }
        .header h1 { font-size: 24px; margin-bottom: 5px; }
        .datetime { font-size: 14px; opacity: 0.9; min-height: 20px; }
        .tabs { display: flex; background: #34495e; overflow-x: auto; scrollbar-width: none; border-bottom: 2px solid #2c3e50; }
        .tabs::-webkit-scrollbar { display: none; }
        .tab { flex: 1; min-width: 120px; padding: 15px; background: #34495e; color: white; border: none; cursor: pointer; font-size: 14px; transition: background 0.3s; position: relative; border-right: 1px solid #2c3e50; text-align: center; }
        .tab.active { background: #2c3e50; font-weight: bold; border-bottom: 3px solid #3498db; }
        .tab-close { position: absolute; top: 5px; right: 5px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 18px; height: 18px; font-size: 12px; cursor: pointer; line-height: 1; }
        .add-tab-btn { padding: 0 25px; background: #27ae60; color: white; border: none; cursor: pointer; font-size: 24px; font-weight: bold; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
        .content { padding: 20px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 10px; }
        .priority-buttons { display: flex; gap: 5px; }
        .priority-btn { width: 40px; height: 40px; border-radius: 50%; border: 3px solid transparent; color: white; font-weight: bold; cursor: pointer; }
        .priority-btn.selected { border-color: #2c3e50; transform: scale(1.1); box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        .priority-btn-1 { background: #e74c3c; }
        .priority-btn-2 { background: #f39c12; }
        .priority-btn-3 { background: #27ae60; }
        .task-input { flex: 1; padding: 10px; border: 2px solid #bdc3c7; border-radius: 5px; font-size: 16px; }
        .add-btn { width: 100%; padding: 12px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; margin-bottom: 20px; }
        
        .task { background: #f9f9f9; border-radius: 8px; margin-bottom: 10px; position: relative; overflow: hidden; border-left: 5px solid #ccc; transition: all 0.3s ease; }
        .priority-1 { border-left-color: #e74c3c; }
        .priority-2 { border-left-color: #f39c12; }
        .priority-3 { border-left-color: #27ae60; }
        
        .task-bar { height: 100%; position: absolute; left: 0; top: 0; opacity: 0.3; z-index: 1; transition: width 0.4s ease; }
        .priority-1 .task-bar { background: #e74c3c; }
        .priority-2 .task-bar { background: #f39c12; }
        .priority-3 .task-bar { background: #27ae60; }

        .task-content { padding: 12px; display: flex; align-items: center; gap: 10px; position: relative; z-index: 2; }
        .task-text { flex: 1; font-size: 15px; font-weight: 500; }
        .task-text.completed { text-decoration: line-through; opacity: 0.5; color: #7f8c8d; }
        .task-progress { padding: 5px; border-radius: 4px; border: 1px solid #ccc; background: white; }
        .task-delete { background: #e74c3c; color: white; border: none; border-radius: 5px; width: 30px; height: 30px; cursor: pointer; font-weight: bold; }
        
        .separator { margin: 20px 0 10px; border-bottom: 2px dashed #bdc3c7; position: relative; text-align: center; }
        .separator span { background: white; padding: 0 10px; position: relative; top: 10px; color: #95a5a6; font-size: 12px; font-weight: bold; text-transform: uppercase; }
        .no-tasks { text-align: center; color: #95a5a6; padding: 20px; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Juliu's Special 5</h1>
        <div class="datetime" id="datetime">Iniciando...</div>
    </div>
    <div class="tabs" id="tabs"></div>
    <div class="content" id="content"></div>
</div>

<script>
const App = {
    tabs: [{name: 'Principal', tasks: []}],
    activeTab: 0,
    taskIdCounter: 0,
    selectedPriority: 2,

    init() {
        this.loadFromStorage();
        this.updateDateTime();
        setInterval(() => this.updateDateTime(), 1000);
        this.renderTabs();
    },

    updateDateTime() {
        const el = document.getElementById('datetime');
        if (!el) return;
        const now = new Date();
        const options = { weekday: 'long', day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit' };
        el.textContent = now.toLocaleDateString('es-ES', options);
    },

    saveToStorage() {
        localStorage.setItem('js5_final_save', JSON.stringify({
            tabs: this.tabs,
            activeTab: this.activeTab,
            counter: this.taskIdCounter
        }));
    },

    loadFromStorage() {
        const saved = localStorage.getItem('js5_final_save');
        if (saved) {
            const parsed = JSON.parse(saved);
            this.tabs = parsed.tabs || [{name: 'Principal', tasks: []}];
            this.activeTab = parsed.activeTab || 0;
            this.taskIdCounter = parsed.counter || 0;
        }
    },

    addNewTab() {
        const name = prompt('Nombre de la nueva lista:');
        if (name && name.trim() !== "") {
            this.tabs.push({ name: name.trim(), tasks: [] });
            this.activeTab = this.tabs.length - 1;
            this.saveToStorage();
            this.renderTabs();
        }
    },

    deleteTab(index, e) {
        e.stopPropagation();
        if (this.tabs.length <= 1) return alert("Debes tener al menos una lista.");
        if (confirm(`¿Eliminar la lista "${this.tabs[index].name}"?`)) {
            this.tabs.splice(index, 1);
            this.activeTab = 0;
            this.saveToStorage();
            this.renderTabs();
        }
    },

    renderTabs() {
        const container = document.getElementById('tabs');
        container.innerHTML = '';
        this.tabs.forEach((tab, i) => {
            const btn = document.createElement('button');
            btn.className = `tab ${i === this.activeTab ? 'active' : ''}`;
            btn.textContent = tab.name;
            btn.onclick = () => { this.activeTab = i; this.saveToStorage(); this.renderTabs(); };
            if (this.tabs.length > 1) {
                const close = document.createElement('button');
                close.className = 'tab-close';
                close.innerHTML = '×';
                close.onclick = (e) => this.deleteTab(i, e);
                btn.appendChild(close);
            }
            container.appendChild(btn);
        });
        const addBtn = document.createElement('button');
        addBtn.className = 'add-tab-btn';
        addBtn.innerHTML = '+';
        addBtn.onclick = () => this.addNewTab();
        container.appendChild(addBtn);
        this.renderContent();
    },

    renderContent() {
        const container = document.getElementById('content');
        const currentTab = this.tabs[this.activeTab] || this.tabs[0];

        // SEPARAR TAREAS: Pendientes vs Completadas
        const pendingTasks = currentTab.tasks.filter(t => t.progress < 100);
        const completedTasks = currentTab.tasks.filter(t => t.progress == 100);

        const renderTaskHTML = (t) => `
            <div class="task priority-${t.priority}">
                <div class="task-bar" style="width: ${t.progress}%"></div>
                <div class="task-content">
                    <span class="task-text ${t.progress == 100 ? 'completed' : ''}">${t.text}</span>
                    <select class="task-progress" onchange="App.updateProgress(${t.id}, this.value)">
                        <option value="0" ${t.progress == 0 ? 'selected' : ''}>0%</option>
                        <option value="25" ${t.progress == 25 ? 'selected' : ''}>25%</option>
                        <option value="50" ${t.progress == 50 ? 'selected' : ''}>50%</option>
                        <option value="75" ${t.progress == 75 ? 'selected' : ''}>75%</option>
                        <option value="100" ${t.progress == 100 ? 'selected' : ''}>100%</option>
                    </select>
                    <button class="task-delete" onclick="App.deleteTask(${t.id})">×</button>
                </div>
            </div>
        `;

        container.innerHTML = `
            <div class="add-task">
                <div class="input-group">
                    <div class="priority-buttons">
                        ${[1, 2, 3].map(p => `
                            <button class="priority-btn priority-btn-${p} ${this.selectedPriority === p ? 'selected' : ''}" onclick="App.setPriority(${p})">${p}</button>
                        `).join('')}
                    </div>
                    <input type="text" id="taskInput" class="task-input" placeholder="Nueva tarea...">
                </div>
                <button class="add-btn" onclick="App.addTask()">AGREGAR TAREA</button>
            </div>
            <div class="task-list">
                ${pendingTasks.length === 0 && completedTasks.length === 0 ? '<div class="no-tasks">No hay tareas.</div>' : ''}
                
                ${pendingTasks.map(t => renderTaskHTML(t)).join('')}

                ${completedTasks.length > 0 ? '<div class="separator"><span>Completadas</span></div>' : ''}

                ${completedTasks.map(t => renderTaskHTML(t)).join('')}
            </div>
        `;

        document.getElementById('taskInput')?.focus();
        document.getElementById('taskInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.addTask();
        });
    },

    setPriority(p) {
        this.selectedPriority = p;
        this.renderContent();
    },

    addTask() {
        const input = document.getElementById('taskInput');
        if (!input || !input.value.trim()) return;
        this.tabs[this.activeTab].tasks.push({
            id: Date.now(),
            text: input.value.trim(),
            priority: this.selectedPriority,
            progress: 0
        });
        this.saveToStorage();
        this.renderContent();
    },

    updateProgress(id, val) {
        const task = this.tabs[this.activeTab].tasks.find(t => t.id === id);
        if (task) task.progress = parseInt(val);
        this.saveToStorage();
        this.renderContent();
    },

    deleteTask(id) {
        this.tabs[this.activeTab].tasks = this.tabs[this.activeTab].tasks.filter(t => t.id !== id);
        this.saveToStorage();
        this.renderContent();
    }
};

window.onload = () => App.init();
</script>
</body>
</html>
